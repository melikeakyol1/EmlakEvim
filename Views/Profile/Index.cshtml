@{
    ViewData["Title"] = "Profilim";
}

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        background-color: #f8fafc;
    }

    .nav-active {
        background-color: #eff6ff !important;
        color: #2563eb !important;
        border-right: 4px solid #2563eb;
        font-weight: 600;
    }
</style>

<div class="max-w-7xl mx-auto px-4 py-10">
    <div class="flex flex-col md:flex-row gap-8">

        <aside class="w-full md:w-72 flex-shrink-0">
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden sticky top-10">
                <div class="p-6 border-b border-gray-50">
                    <h2 class="text-xl font-bold text-gray-800">Hesap Paneli</h2>
                </div>

                <nav class="flex flex-col py-2" id="sidebarNav">
                    <a href="javascript:void(0)" class="nav-link flex items-center gap-3 px-6 py-4 text-gray-600 hover:bg-gray-50 transition"
                       onclick="setActive(this); loadContent('ProfilBilgilerim')">
                        <i class="fa fa-user w-5 text-center text-lg"></i> Profil Bilgilerim
                    </a>

                    <a href="javascript:void(0)" class="nav-link flex items-center gap-3 px-6 py-4 text-gray-600 hover:bg-gray-50 transition"
                       onclick="setActive(this); loadContent('Ilanlarim')">
                        <i class="fa fa-home w-5 text-center text-lg"></i> İlanlarım
                    </a>

                    <a href="javascript:void(0)" class="nav-link flex items-center gap-3 px-6 py-4 text-gray-600 hover:bg-gray-50 transition"
                       onclick="setActive(this); loadContent('Favorilerim')">
                        <i class="fa fa-heart w-5 text-center text-lg"></i> Favorilerim
                    </a>

                    <a href="javascript:void(0)" class="nav-link flex items-center gap-3 px-6 py-4 text-gray-600 hover:bg-gray-50 transition"
                       onclick="setActive(this); loadContent('SifreDegistir')">
                        <i class="fa fa-lock w-5 text-center text-lg"></i> Şifre Değiştir
                    </a>

                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <a asp-controller="Kullanici" asp-action="Logout"
                           class="flex items-center gap-3 px-6 py-4 text-red-500 hover:bg-red-50 transition font-medium">
                            <i class="fa fa-sign-out-alt w-5 text-center text-lg"></i> Çıkış Yap
                        </a>
                    </div>
                </nav>
            </div>
        </aside>

        <main class="flex-1">
            <div id="contentArea" class="bg-white rounded-[2rem] shadow-sm border border-gray-100 p-8 min-h-[600px]">
            </div>
        </main>

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const initialTab = document.querySelector('a[onclick*="Ilanlarim"]');
        if(initialTab) {
            setActive(initialTab);
            loadContent('Ilanlarim');
        }
    });

    function setActive(el) {
        document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('nav-active'));
        el.classList.add('nav-active');
    }

    function loadContent(action) {
        const area = document.getElementById('contentArea');
        area.innerHTML = `
            <div class="flex flex-col items-center justify-center py-40">
                <div class="w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"></div>
            </div>`;

        fetch('/Profile/' + action)
            .then(res => res.text())
            .then(html => {
                area.innerHTML = html;
            });

    }
    function saveProfile() {
        const form = document.getElementById('editProfileForm');
        if (!form) return;

        const formData = new FormData(form);

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Kaydediliyor...';

        fetch('/Profile/EditProfile', {
            method: 'POST',
            body: formData
        })
        .then(res => res.text())
        .then(result => {
            if (result.trim() === "success") {
                alert("Bilgileriniz başarıyla güncellendi.");
                loadContent('ProfilBilgilerim');
            } else {
                alert("Hata oluştu: " + result);
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        })
        .catch(err => {
            console.error("Hata:", err);
            alert("Sunucuya bağlanırken bir hata oluştu.");
            btn.disabled = false;
            btn.innerHTML = originalText;
        });
    }
</script>
